angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}]),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("example",{url:"/example",templateUrl:"./views/example/example.html",controller:"exampleCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("example",{url:"/example",templateUrl:"./views/example/example.html",controller:"exampleCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("example",{url:"/example",templateUrl:"./views/example/example.html",controller:"exampleCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp",["ui.router"]).config(function(t,e){t.state("home",{url:"/",templateUrl:"./views/home/home.html",controller:"mainCtrl"}).state("upload",{url:"/upload",templateUrl:"./views/upload/upload.html",controller:"uploadCtrl"}).state("example",{url:"/example",templateUrl:"./views/example/example.html",controller:"exampleCtrl"}).state("about",{url:"/about",templateUrl:"./views/about/about.html",controller:"mainCtrl"}).state("contact",{url:"/contact",templateUrl:"./views/contact/contact.html",controller:"mainCtrl"}).state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"./views/signup/signup.html",controller:"signupCtrl"}).state("dashboard",{url:"/dashboard",templateUrl:"./views/dashboard/dashboard.html",controller:"dashboardCtrl"}),e.otherwise("/")}),angular.module("contextApp").service("chartService",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").controller("exampleCtrl",function(t,e,o){t.someNumber,t.check=function(){var t=document.getElementById("file1").files[0];console.log("File Uploaded: ",t),o.getAsText(t)}}),angular.module("contextApp").service("exampleService",function(t,e){function o(t,e,o,l,r,n,a){for(var i=t,c=1;c<=e;++c){a.add({months:1}),qp=o/Math.pow(1+l*(r[r.length-1].mo+c),n),qp=Math.floor(qp);var s={date:new Date(a.toString()),mo:r[r.length-1].mo+c,qp:qp,type:"qp"};i.push(s)}return console.log(i),i}this.testtest="service test",this.serverTest=function(e){return t({method:"GET",url:"http://localhost:3000/wells"}).then(function(t){var e=t.data.map(function(t){return{date:new Date(t.date),oil:t.oil,gas:t.gas}});e=l(e,"date");var a=e[0].date;e=e.map(function(t){var e=t.date.getYear()-a.getYear(),o=t.date.getMonth()-a.getMonth()+12*e;return{date:t.date,oil:parseInt(t.oil),gas:t.gas,mo:o,type:"oil"}});var i=e[0].oil,c=e[0].oil,s=e[e.length-1].oil,u=e.length-1,d=Math.floor(Math.sqrt(c*s)),p=13;e=l(e,"oil"),p=r(e,d,"mo","oil"),e=l(e,"date");var h=(0+u-2*p)/(p*p-0*u),g=(e[e.length-1].oil+e[e.length-2].oil+e[e.length-1].oil)/3,m=e.length-1,f=Math.log(i/g)/Math.log(1+h*m);qpArr=[],console.log("b",h*f),console.log("a",f),console.log("b/a",h),console.log("q3",d),console.log("t3",p);var v=0;e.forEach(function(t){console.log(t.mo);var e=i/Math.pow(1+h*t.mo,f);e=Math.floor(e),qpArr.push({date:t.date,mo:t.mo,qp:e,oil:t.oil,type:"qp"}),v+=Math.abs(e-t.oil)}),console.log("TotalError",v);var w=new Date(e[e.length-1].date.toString());return qpArr=o(qpArr,24,i,h,e,f,w),n(e,qpArr)})};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s},n=function(t,e){var o=t,l=e,r={top:20,right:20,bottom:30,left:40},n=document.getElementById("chart12").clientWidth-r.right-r.left,a=500-r.bottom-r.top;console.log(n),console.log(document.getElementById("chart12"));var i=d3.time.format("%b %y'"),c=function(t){return t.date},s=d3.time.scale().range([0,n]),u=function(t){return s(c(t))},d=d3.svg.axis().scale(s).orient("bottom").tickFormat(i),p=function(t){return t.oil},h=d3.scale.log().range([a,0]),g=function(t){return h(p(t))},m=d3.svg.axis().scale(h).orient("left").tickFormat(function(t){return t}),f=function(t){return t.qp},v=function(t){return h(f(t))},w=function(t){return t.type},y=d3.scale.category10(),x=d3.select("#chart12").append("svg").attr("width","100%").attr("height","100%").append("g").attr("transform","translate("+r.left+","+r.top+")"),b=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);s.domain(d3.extent(l,function(t){return t.date})).nice(),h.domain(d3.extent(l,function(t){return t.oil})).nice(),x.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(d).append("text").attr("class","label").attr("x",n).attr("y",-6).style("text-anchor","end").text("Date"),x.append("g").attr("class","y axis").call(m).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),x.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",u).attr("cy",g).style("fill",function(t){return y(w(t))}).on("mouseover",function(t){console.log(d3.event.pageX),console.log(d3.event.pageY),b.transition().duration(200).style("opacity",.9),b.html(t.oil+"<br/> ("+c(t)+", "+p(t)+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){b.transition().duration(500).style("opacity",0)}),x.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",u).attr("cy",v).style("fill",function(t){return y(w(t))}).on("mouseover",function(t){console.log(d3.event.pageX),console.log(d3.event.pageY),b.transition().duration(200).style("opacity",.9),b.html(t.qp+"<br/> ("+c(t)+", "+f(t)+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){b.transition().duration(500).style("opacity",0)});var M=x.selectAll(".legend").data(y.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});M.append("rect").attr("x",n-18).attr("width",18).attr("height",18).style("fill",y),M.append("text").attr("x",n-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}),angular.module("contextApp").service("loginService",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html",controller:"navComponentCtrl"}),angular.module("contextApp").controller("navComponentCtrl",function(t,e){}),angular.module("contextApp").controller("mainCtrl",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}),angular.module("contextApp").controller("signupCtrl",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}),angular.module("contextApp").service("signupService",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}),angular.module("contextApp").controller("uploadCtrl",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}),angular.module("contextApp").service("uploadService",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){
this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l}
;o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){
o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;if(new Date(p[0].date.toString()),e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",
controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){console.log("econ prod data",t.redraw),e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){console.log("new controller instance"),t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells.well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells.well_name}),t.logout=function(){o.logout().then(function(t){console.log("should be logged out"),e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){console.log(o.redraw),l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",["$http","$q","chartService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date");for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;var g;new Date(p[0].date.toString()),g=e||p[0].oil,console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x,b,M=(0+v-2*y)/(y*y-0*v),A=p.length-1;if(i){var C=Math.pow(1+i,1/12)-1;b=-1*Math.log(1-C),x=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3}else x=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;console.log("initdeclineNom",b),console.log("qStar",x),console.log("tstar",A);var S;n?S=n/M:(S=Math.log(g/x)/Math.log(1+M*A),n=M*S),qpArr=[],console.log("b",M*S),console.log("a",S),console.log("b/a",M),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E,D=0,q=[];p.forEach(function(t){q.push(t),E=i?g/Math.pow(1+n*i*t.mo,1/n):g/Math.pow(1+M*t.mo,S),E=Math.floor(E),q.push({date:new Date(t.date.toString()),mo:t.mo,qp:E,type:"qp"}),D+=Math.abs(E-t.oil)}),console.log("TotalError",D);var I,$=new Date(p[p.length-1].date.toString());for(I=a||24,h=1;h<=I;++h){$.add({months:1}),E=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+M*(W+h),S),E=Math.floor(E);var U={date:new Date($.toString()),mo:W+h,qp:E,type:"qp",forecast:"y"};q.push(U)}return o.chartMaker(q),q},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;console.log("expinitarr",u);var p;p=e||u[0].oil,console.log("q0",p);var h,g=u[u.length-1].oil,m=u[u.length-1].mo;h=r?-1*Math.log(1-r)/12:(Math.log(p)-Math.log(g))/m,console.log("aValue",h),console.log("a",h),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*h*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f,v=new Date(u[u.length-1].date.toString()),w=u[u.length-1].mo;for(f=n||24,d=1;d<=f;++d){v.add({months:1});var y=p*Math.pow(Math.E,-1*h*(w+d));y=Math.floor(y);var x={date:new Date(v.toString()),mo:w+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}]),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",["$scope","exampleService","uploadService",function(t,e,o){t.check=function(){var t=document.getElementById("file1").files[0],e=document.getElementById("newWellName").value;Materialize.toast(e+" Uploaded Successfully!",4e3),o.getAsText(t,e)}}]),angular.module("contextApp").service("uploadService",["$http","$q",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}}]),angular.module("contextApp").service("chartService",["$http","$q",function(t,e){this.chartMaker=function(t){d3.select("#chart1 svg").remove();var e=["January","February","March","April","May","June","July","August","September","October","November","December"],o=[],l=[];t.forEach(function(t){"oil"===t.type?o.push(t):l.push(t)});var r={top:10,right:100,bottom:40,left:40},n=document.getElementById("chart1").clientWidth,a=document.getElementById("chart1").clientHeight,i=a-r.bottom,c=n-r.right,s=d3.time.format("%b %y'"),u=function(t){return t.date},d=d3.time.scale().range([0,c]),p=function(t){return d(u(t))},h=d3.svg.axis().scale(d).orient("bottom").tickFormat(s),g=[1,10,100,1e3,1e4,1e5],m=function(t){return t[t.type]},f=d3.scale.log().range([i,1]),v=function(t){return f(m(t))},w=d3.svg.axis().scale(f).orient("left").tickFormat(function(t){return-1!==g.indexOf(t)?t:""}),y=function(t){return t.type},x=d3.scale.category10(),b=d3.select("#chart1").append("svg").attr("id","chart1svg").attr("width",n).attr("height",a).append("g").attr("transform","translate("+r.left+","+r.top+")"),M=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(l.length>o.length)var A=l;else var A=o;d.domain(d3.extent(A,function(t){return t.date})).nice(),f.domain(d3.extent(A,function(t){return 0===t[t.type]?1:t[t.type]})).nice(),b.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(h).append("text").attr("class","label").attr("x",n).attr("y",a).style("text-anchor","end").text("Date"),b.append("g").attr("class","y axis").call(w).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Oil Production, bbl/mo"),b.selectAll(".dot").data(o).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(Math.floor(m(t))+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)}),b.selectAll(".dot1").data(l).enter().append("circle").attr("class","dot").attr("r",2).attr("cx",p).attr("cy",v).style("fill",function(t){return x(y(t))}).on("mouseover",function(t){M.transition().duration(200).style("opacity",.9),M.html(m(t)+" bbl/mo <br/> ("+e[u(t).getMonth()]+"-"+u(t).getFullYear()+")").style("position","absolute").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){M.transition().duration(500).style("opacity",0)});var C=b.selectAll(".legend").data(x.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});C.append("rect").attr("x",c-18).attr("width",18).attr("height",18).style("fill",x),C.append("text").attr("x",c-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}}]),angular.module("contextApp").controller("dashboardCtrl",["$scope","$state","dashboardService","chartService",function(t,e,o,l){t.user=o.userInfo,t.panelHide1=!1,t.panelHide2=!1,t.panelHide3=!1,t.wells||o.getWells().then(function(e){o.setWells(e.data),t.wells=o.wells,t.getWellCharts(o.wells[0].well_id,o.wells[0].well_name),o.setCurrentWellId(o.wells[0].well_id),t.currentWellId=o.wells[0].well_id,o.setCurrentWellName(o.wells[0].well_name),t.currentWellName=o.wells[0].well_name}),t.logout=function(){o.logout().then(function(t){e.go("home")})},t.getWellCharts=function(e,l){t.currentWellId=e,o.setCurrentWellId(e),t.currentWellName=l,o.setCurrentWellName(l),t.currentWellName=o.currentWellName,o.getWellCharts(e).then(function(t){o.setProdData(t),o.setRedraw(t)})},t.removeWell=function(e){console.log("removewell Id",e),o.removeWell(e).then(function(e){1===e.data&&(Materialize.toast(o.currentWellName+" Removed Successfully!",4e3),o.getWells().then(function(e){t.wells=e.data,o.setWells(e.data),t.getWellCharts(o.wells[0].well_id)}))})},window.addEventListener("resize",function(){l.chartMaker(o.redraw)})}]),angular.module("contextApp").service("dashboardService",function(t,e,o){this.test="dashboard Service working",this.setRedraw=function(t){this.redraw=t},this.setEconArr=function(t){this.econArr=t},this.setUserInfo=function(t){this.userInfo=t},this.setCurrentWellId=function(t){this.currentWellId=t},this.setCurrentWellName=function(t){this.currentWellName=t},this.setProdData=function(t){this.prodData=t},this.setWells=function(t){this.wells=t},this.logout=function(){return t({method:"GET",url:"http://localhost:3000/logout"})},this.getWells=function(e){return t({method:"GET",url:"http://localhost:3000/wells/wellsbyuser"})},this.removeWell=function(e){return t({method:"DELETE",url:"http://localhost:3000/wells/removewell?well_id="+e})},this.getWellCharts=function(e){var r=e.toString();return t({method:"GET",url:"http://localhost:3000/wells?well_id="+r}).then(function(t){var e=new Date(l(t.data,"date")[0].prod_date.toString());console.log("t0",e);var r=t.data.map(function(t){var o=new Date(t.prod_date),l=o.getYear()-e.getYear(),r=o.getMonth()-e.getMonth()+12*l;return 0===parseFloat(t.prod_oil)&&(t.prod_oil=".01"),{date:o,oil:parseFloat(t.prod_oil),mo:r,type:"oil"}});return r=l(r,"date"),d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove(),o.chartMaker(r),r})},this.economicModelCalc=function(t,e,o,r,n,a,i){var c=t.filter(function(t){return"y"===t.forecast});c=l(c,"date"),console.log("checkArr",c);for(var s=0,u=0,d=0,p=0;p<c.length;p++)s+=c[p].qp,c[p].mo=p+1,c[p].mNp=s,c[p].oilPrice=o,c[p].revGross=Math.round(c[p].qp*o),c[p].nRI=r,c[p].royalty=Math.round(c[p].revGross*(1-r)),c[p].wIR=Math.round(c[p].revGross-c[p].royalty),c[p].sevTax=n,c[p].sevAdVel=Math.round(c[p].wIR*n),c[p].OilRev=Math.round(c[p].wIR-n),c[p].netOilRev=Math.round(c[p].OilRev-a),c[p].opCost=a,u+=c[p].netOilRev,c[p].cumOilRev=Math.round(u),c[p].presValue=Math.round(c[p].netOilRev*(1/Math.pow(1+i/12,c[p].mo))),d+=c[p].presValue,c[p].cumPresValue=Math.round(d-e),(c[p].mo%12==0&&c[p].presValue>0||p===c.length-1&&c[p].presValue>0||p>0&&c[p-1].presValue>0&&c[p].presValue<0)&&(c[p].yr=Math.round(c[p].mo/12*100)/100);return econArr=c.filter(function(t){return t.yr}),econArr},this.hyperbolicDeclineCalc=function(t,e,n,a,i,c,s){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var u=new Date(c),d=new Date(s),p=t;c&&!s?p=p.filter(function(t){return t.date>=u}):!c&&s?p=p.filter(function(t){return t.date<=d}):c&&s&&(p=p.filter(function(t){return t.date>=u&&t.date<=d})),p=l(p,"date");for(var h=0;h<p.length;++h)p[h].mo=h;new Date(p[0].date.toString());if(e)var g=e;else var g=p[0].oil;console.log("q0",g);var m=p[0].oil,f=p[p.length-1].oil,v=p.length-1,w=Math.floor(Math.sqrt(m*f)),y=13;p=l(p,"oil"),y=r(p,w,"mo","oil"),p=l(p,"date");var x=(0+v-2*y)/(y*y-0*v),b=p.length-1;if(i)var M=Math.pow(1+i,1/12)-1,A=-1*Math.log(1-M),C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;else var C=(p[p.length-1].oil+p[p.length-2].oil+p[p.length-3].oil)/3;if(console.log("initdeclineNom",A),console.log("qStar",C),console.log("tstar",b),n)var S=n/x;else var S=Math.log(g/C)/Math.log(1+x*b),n=x*S;qpArr=[],console.log("b",x*S),console.log("a",S),console.log("b/a",x),console.log("q3",w),console.log("t3",y);var W=p[p.length-1].mo;console.log("lastmo",W);var E=0,D=[];p.forEach(function(t){if(D.push(t),i)var e=g/Math.pow(1+n*i*t.mo,1/n);else var e=g/Math.pow(1+x*t.mo,S);e=Math.floor(e),D.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"}),E+=Math.abs(e-t.oil)}),console.log("TotalError",E);var q=new Date(p[p.length-1].date.toString());if(a)var I=a;else var I=24;for(var h=1;h<=I;++h){q.add({months:1}),qp=i?g/Math.pow(1+n*i*(W+h),1/n):g/Math.pow(1+x*(W+h),S),qp=Math.floor(qp);var $={date:new Date(q.toString()),mo:W+h,qp:qp,type:"qp",forecast:"y"};D.push($)}return o.chartMaker(D),D},this.getExpDeclineCalc=function(t,e,r,n,a,i){d3.select("#chart1 svg")&&d3.select("#chart1 svg").remove();var c=new Date(a),s=new Date(i),u=t;a&&!i?u=u.filter(function(t){if(t.date>=c)return t}):!a&&i?u=u.filter(function(t){if(t.date<=s)return t}):a&&i&&(u=u.filter(function(t){if(t.date>=c&&t.date<=s)return t})),u=l(u,"date");for(var d=0;d<u.length;++d)u[d].mo=d;if(console.log("expinitarr",u),e)var p=e;else var p=u[0].oil;console.log("q0",p);var h=u[u.length-1].oil,g=u[u.length-1].mo;if(r)var m=-1*Math.log(1-r)/12;else var m=(Math.log(p)-Math.log(h))/g;console.log("aValue",m),console.log("a",m),expArr=[],u.forEach(function(t){var e=p*Math.pow(Math.E,-1*m*t.mo);expArr.push(t),expArr.push({date:new Date(t.date.toString()),mo:t.mo,qp:e,type:"qp"})});var f=new Date(u[u.length-1].date.toString()),v=u[u.length-1].mo;if(n)var w=n;else var w=24;for(var d=1;d<=w;++d){f.add({months:1});var y=p*Math.pow(Math.E,-1*m*(v+d));y=Math.floor(y);var x={date:new Date(f.toString()),mo:v+d,qp:y,type:"qp",forecast:"y"};expArr.push(x)}return console.log("expArr",expArr),o.chartMaker(expArr),expArr};var l=function(t,e){return t=t.sort(function(t,o){return"date"===e?t[e]-o[e]:o[e]-t[e]})},r=function(t,e,o,l){t=t.sort(function(t,e){return parseInt(e[l])-parseInt(t[l])});for(var r,n,a,i=0,c=0;c<t.length;++c)t[c][l]<e&&(r=t[c-1][l],n=t[c][l],a=t[c-1][o],i=t[c][o],c=t.length);var s=a+(r-e)/(r-n)*(a-i);return console.log("interpolatedValue",s),s}}),angular.module("contextApp").component("economicModel",{controllerAs:"vmEcon",templateUrl:"./views/economicModel/economicModel.html",controller:["dashboardService",function(t){var e=this;e.getEconomicModel=function(o,l,r,n,a,i){e.econArr=t.economicModelCalc(t.redraw,o,l,r,n,a,i),t.setEconArr(econArr)},e.printEconomicModel=function(){var t=window.open("","new div","height=700,width=800");return t.document.write("<html><head><title></title>"),t.document.write('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css" type="text/css" media="print">>'),t.document.write(' <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons type="text/css" media="print">'),t.document.write(' <link rel="stylesheet" href="./style.css" type="text/css" media="print">'),t.document.write("</head><body >"),t.document.write($("#printContainer").html()),t.document.write('<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>'),t.document.write('<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.min.js"></script>'),t.document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.4.2/angular-ui-router.js"></script>'),t.document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>'),t.document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>'),t.document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>'),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(function(){t.print(),setTimeout(function(){t.close()},1500)},1500),!0}}]}),angular.module("contextApp").component("exponentialPlot",{controllerAs:"vmExp",templateUrl:"./views/exponentialPlot/exponentialPlot.html",controller:["dashboardService",function(t){var e=this;e.plotExponential=function(e,o,l,r,n){var a=t.getExpDeclineCalc(t.prodData,e,o,l,r,n);t.setRedraw(a)},e.panelShow4=!1}]}),angular.module("contextApp").component("hyperbolicPlot",{controllerAs:"vmHyp",templateUrl:"./views/hyperbolicPlot/hyperbolicPlot.html",controller:["dashboardService",function(t){var e=this;e.plotHyperbolic=function(e,o,l,r,n,a){var i=t.hyperbolicDeclineCalc(t.prodData,e,o,l,r,n,a);t.setRedraw(i)},e.panelShow4=!1}]}),angular.module("contextApp").controller("loginCtrl",["$scope","$location","loginService","$state","dashboardService",function(t,e,o,l,r){t.login=function(t,l){var n={email:t,password:l};o.loginUser(n).then(function(t){e.path("dashboard"),r.setUserInfo(t.data)},function(t){console.log(t.data),window.alert("Incorrect Login")})}}]),angular.module("contextApp").service("loginService",["$http","$q",function(t,e){this.test="logintest",this.loginUser=function(e){return t({method:"POST",url:"http://localhost:3000/api/login",data:e}).then(function(t){return t})}}]),angular.module("contextApp").controller("mainCtrl",["$scope",function(t){$(document).ready(function(){$(".parallax").parallax(),$(".button-collapse").sideNav(),$(".side-nav").click(function(){$(".button-collapse").sideNav("hide")})})}]),angular.module("contextApp").component("navComponent",{templateUrl:"./views/navComponent/navComponent.html"}),angular.module("contextApp").controller("signupCtrl",["$scope","signupService",function(t,e){t.Signup=function(t,o,l,r){console.log("running signup");var n={name:t,email:o,password:l};console.log(n),l!==r?window.alert("Passwords do not match"):e.createUser(n).then(function(t){console.log("signupControlelr",t)})}}]),angular.module("contextApp").service("signupService",["$http","$q",function(t,e){this.createUser=function(e){return t({method:"POST",url:"http://localhost:3000/users",data:e})}}]),angular.module("contextApp").controller("uploadCtrl",function(t,e){t.check=function(){var t=document.getElementById("file1").files[0],o=document.getElementById("newWellName").value;Materialize.toast(o+" Uploaded Successfully!",4e3),e.getAsText(t,o)}}),angular.module("contextApp").service("uploadService",function(t,e){this.getAsText=function(t,e){var r=new FileReader;r.readAsText(t),r.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},r.onloadend=function(t){var r=t.target.result;console.log("csv",r),console.log(o(r)),l(o(r),e)}};var o=function(t){for(var e=["prod_date","prod_oil"],o=t.split(/\r\n|\n/),l=[],r=0;r<o.length;r++){for(var n=o[r].split(","),a={},i=0;i<n.length;i++)"prod_oil"===e[i]?a[e[i]]=parseInt(n[i]):"prod_date"===e[i]&&(a[e[i]]=new Date(n[i]));l.push(a)}return console.log(l),l.pop(l.length-1),l},l=function(e,o){return uploadFileFinal={wellname:o,wellinfo:e},console.log("Example Service - fileUpload running: ",e),t({method:"POST",url:"http://localhost:3000/wells/upload",data:uploadFileFinal})}});